<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trades Interface</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            max-width: 640px;
            height: 100vh;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        .mobile-container {
            width: 100%;
            height: 90%;
            overflow: hidden;
            position: relative;
        }
        #main-content {
            height: calc(100% - 120px);
            overflow: hidden;
            position: relative;
        }
        .chart-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #chart {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .trading-actions {
            position: absolute;
            left: 50%;
            bottom: -85px;
            transform: translate(-50%, -50%);
            width: 80%;
            z-index: 1;
            backdrop-filter: blur(10px);
            background-color: rgba(55, 65, 81, 0.8);
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #calculatorModal, #timeModal {
            z-index: 2;
        }
        .slider-wrapper {
            position: absolute;
            left: 50%;
            bottom: 240px;
            transform: translate(-50%, -50%);
            width: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider-container {
            position: relative;
            width: 100%;
            height: 5px;
            background: #FF5252;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-left, .progress-right {
            position: relative;
            color: white;
            font-size: 14px;
            font-weight: bold;
            z-index: 3;
            min-width: 45px;
            text-align: center;
        }

        .progress-left {
            margin-right: 10px;
        }

        .progress-right {
            margin-left: 10px;
        }

        .slider-bar {
            width: 100%;
            height: 100%;
            background: #4CAF50;
            animation: progressAnimation 10s linear infinite;
            transform-origin: left center;
        }

        @keyframes progressAnimation {
            0% {
                transform: scaleX(0);
            }
            100% {
                transform: scaleX(1);
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container bg-gray-900 text-white">
        <div id="top-nav"></div>
        <!-- Restore original single container -->
        <div id="main-content" class="h-full overflow-y-auto"></div>
        <div id="bottom-nav"></div>
    </div>

    <!-- Replace welcome template with forex graph template -->
    <template id="welcome-template">
        <div class="h-full relative">
            <!-- Full screen chart -->
            <div class="chart-container">
                <div id="chart"></div>
            </div>

            <!-- Updated Slider Structure -->
            <div class="slider-wrapper">
                <span class="progress-left">0%</span>
                <div class="slider-container">
                    <div class="slider-bar"></div>
                </div>
                <span class="progress-right">100%</span>
            </div>

            <!-- Trading Actions Overlay -->
            <div class="trading-actions">
                <div class="flex justify-between items-center mb-4">
                    <div id="timeContainer" class="cursor-pointer">
                        <p class="text-sm text-gray-400">Time</p>
                        <div class="bg-gray-800 p-2 rounded-lg flex items-center space-x-2">
                            <span id="timeDisplay" class="text-white">00:01:00</span>
                            <span class="text-white">‚è∞</span>
                        </div>
                    </div>
                    <div id="amountContainer" class="cursor-pointer">
                        <p class="text-sm text-gray-400">Amount</p>
                        <div class="bg-gray-800 p-2 rounded-lg flex items-center space-x-2">
                            <span id="amountDisplay" class="text-white">10</span>
                            <span class="text-white">üí≤</span>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between text-green-400 text-lg font-semibold mb-4">
                    <p>Payout<br><span class="text-white text-sm">$16.20</span></p>
                    <p>+62%</p>
                    <p>Profit<br><span class="text-white text-sm">+$6.20</span></p>
                </div>
                <div class="flex space-x-4">
                    <button class="bg-green-600 text-white py-2 flex-1 rounded-lg flex items-center justify-center space-x-2">
                        <span>‚û°Ô∏è</span>
                        <span>BUY</span>
                    </button>
                    <button class="bg-red-600 text-white py-2 flex-1 rounded-lg flex items-center justify-center space-x-2">
                        <span>‚û°Ô∏è</span>
                        <span>SELL</span>
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- NEW: Time Input Modal -->
    <div id="timeModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-gray-800 p-4 rounded-lg w-80">
            <h3 class="text-white text-lg mb-4">Set Time</h3>
            <input type="text" id="timeInput" class="w-full p-2 rounded-lg mb-4" placeholder="e.g. 00:01:00">
            <div class="flex justify-end space-x-2">
                <button id="cancelTime" class="px-4 py-2 bg-gray-600 text-white rounded">Cancel</button>
                <button id="saveTime" class="px-4 py-2 bg-blue-500 text-white rounded">Save</button>
            </div>
        </div>
    </div>

    <!-- NEW: Calculator Modal for Amount (updated with basic operations) -->
    <div id="calculatorModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-gray-800 p-4 rounded-lg w-80">
            <h3 class="text-white text-lg mb-4">Calculator</h3>
            <input type="text" id="calcDisplay" class="w-full p-2 rounded-lg mb-4 text-right" readonly value="10">
            <div id="calcButtons" class="grid grid-cols-4 gap-2 mb-4">
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">7</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">8</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">9</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">/</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">4</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">5</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">6</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">*</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">1</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">2</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">3</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">-</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">0</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">.</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">=</button>
                <button class="calc-btn bg-gray-700 text-white p-2 rounded">+</button>
                <button id="calcClear" class="col-span-4 bg-gray-700 text-white p-2 rounded">Clear</button>
            </div>
            <div class="flex justify-end space-x-2">
                <button id="cancelCalc" class="px-4 py-2 bg-gray-600 text-white rounded">Cancel</button>
                <button id="confirmCalc" class="px-4 py-2 bg-blue-500 text-white rounded">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Move scripts to end of body -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="js/custom-chart.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/dropdown.js"></script>
    <script src="js/account-dropdown.js"></script>
    <script>

        // Update initialization function to include chart
        async function initializeComponents() {
            try {
                // Load top nav
                const topNavResponse = await fetch('components/top-nav.html');
                const topNavHtml = await topNavResponse.text();
                document.getElementById('top-nav').innerHTML = topNavHtml;

                // Load bottom nav
                const bottomNavResponse = await fetch('components/bottom-nav.html');
                const bottomNavHtml = await bottomNavResponse.text();
                document.getElementById('bottom-nav').innerHTML = bottomNavHtml;

                // Initialize dropdown after components are loaded
                console.log('Components loaded, initializing dropdown...');
                initializeAccountDropdown();

                // Show welcome template content
                const template = document.getElementById('welcome-template');
                document.getElementById('main-content').innerHTML = template.innerHTML;
                
                // Initialize chart after template is loaded
                window.forexChart.initialize();

                // Initialize Time Modal Bindings after dynamic insertion
                initTimeModal();
                // Bind Calculator Modal events
                initCalcModal();
                // Initialize counter after template is loaded
                updateCounter();
            } catch (error) {
                console.error('Error initializing components:', error);
            }
        }

        function initTimeModal() {
            const timeContainer = document.getElementById('timeContainer');
            const timeModal = document.getElementById('timeModal');
            const timeInput = document.getElementById('timeInput');
            const timeDisplay = document.getElementById('timeDisplay');
            const cancelTime = document.getElementById('cancelTime');
            const saveTime = document.getElementById('saveTime');

            if(!timeContainer) {
                console.error('Time container not found.');
                return;
            }

            timeContainer.addEventListener('click', () => {
                timeInput.value = timeDisplay.textContent.trim();
                timeModal.classList.remove('hidden');
            });

            cancelTime.addEventListener('click', () => { timeModal.classList.add('hidden'); });
            timeModal.addEventListener('click', (e) => { if(e.target === timeModal) timeModal.classList.add('hidden'); });
            saveTime.addEventListener('click', () => {
                const newTime = timeInput.value.trim() || '00:00:00';
                timeDisplay.textContent = newTime;
                timeModal.classList.add('hidden');
            });
        }

        function initCalcModal() {
            const amountContainer = document.getElementById('amountContainer');
            const calculatorModal = document.getElementById('calculatorModal');
            const calcDisplay = document.getElementById('calcDisplay');
            const cancelCalc = document.getElementById('cancelCalc');
            const confirmCalc = document.getElementById('confirmCalc');

            // Bind buttons for digits and operations
            document.querySelectorAll('.calc-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = btn.textContent.trim();
                    if (value === "=") {
                        try {
                            calcDisplay.value = eval(calcDisplay.value);
                        } catch (error) {
                            calcDisplay.value = "Error";
                        }
                    } else {
                        if (calcDisplay.value === "0" || calcDisplay.value === "Error") {
                            calcDisplay.value = value;
                        } else {
                            calcDisplay.value += value;
                        }
                    }
                });
            });

            amountContainer.addEventListener('click', () => {
                const amountDisplay = document.getElementById('amountDisplay');
                calcDisplay.value = amountDisplay.textContent.trim();
                calculatorModal.classList.remove('hidden');
            });

            cancelCalc.addEventListener('click', () => { calculatorModal.classList.add('hidden'); });
            calculatorModal.addEventListener('click', (e) => {
                if (e.target === calculatorModal) calculatorModal.classList.add('hidden');
            });

            document.getElementById('calcClear').addEventListener('click', () => {
                calcDisplay.value = "";
            });

            confirmCalc.addEventListener('click', () => {
                const amountDisplay = document.getElementById('amountDisplay');
                amountDisplay.textContent = calcDisplay.value || "0";
                calculatorModal.classList.add('hidden');
            });
        }

        function updateCounter() {
            const leftCounter = document.querySelector('.progress-left');
            const rightCounter = document.querySelector('.progress-right');
            let count = 0;
            
            setInterval(() => {
                count = count >= 100 ? 0 : count + 1;
                leftCounter.textContent = `${count}%`;
                rightCounter.textContent = `${100 - count}%`;
            }, 100); // Updates every 100ms for a total of 10 seconds (100 steps)
        }

        // Start initialization
        initializeComponents();
    </script>
</body>
</html>